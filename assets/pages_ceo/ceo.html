<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쿼티의민족 사장님 광장</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/ceo.css">

    <!-- axios -->
    <script src="http://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <!-- 본문바로가기 -->
    <p id="skipNav" class="hide"><a href="../pages_ceo/index.html">본문 바로가기</a></p>

    <div id="wrap">
        <!-- header -->
        <header id="header">
            <div class="inner">
                <h1><a href="../index.html">Qwerty's Delivery - CEO</a></h1>
                <nav class="nav">
                    <ul class="gnb">
                        <li><a href="./ceoLogin/html">로그인</a></li>
                        <li><a href="./ceoSignup.html">회원가입</a></li>
                        <li><a href="./ceoGet.html">회원정보</a></li>
                        <li><a onclick="logout();">로그아웃</a></li>
                    </ul>
                </nav>
                <div class="searchWrap">
                    <input type="text" placeholder="메뉴를 입력해주세요"/>
                    <button class="search">검색</button>
                </div>
            </div>
        </header>

        <!-- subvisual -->
        <section id="subvisual"></section>

        <!-- main -->
        <main id="container" class="main">
            <section id="content">
                <div class="ceoPostWrap">
                    <div class="ceoPost">
                        <h3>사장님! 여기서 음식올리세요 :&#41;</h3>
                        <p>음식 조회,추가,수정,삭제</p>

                        <form class="remote">
                            <span class="center"> 
                                <select>
                                    <option value="메뉴이름" name="메뉴이름">메뉴이름</option>
                                    <option value="가격" name="가격">가격</option>
                                </select>
                                <input type="text"/> 
                                <input type="button" name="검색" class="gradient" value="검색"/>
                            </span>
                        </form>
                            
                        <table class="menu" id="menuTable">
                            <thead>
                              <tr>
                                <th>스토어 Id</th>
                                <th>메뉴이름</th>
                                <th>메뉴사진</th>
                                <th>가격</th>
                                <th>메뉴수정</th>
                                <th>메뉴삭제</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td id="storeId"></td>
                                <td id="menuName"></td>
                                <td id="menuImage"></td>
                                <td id="price"></td>
                                <td>
                                    <button class="changeBtn" onclick="menuChange();">메뉴수정</button>
                                </td>
                                <td>
                                    <button class="deleteBtn" onclick="menuDelete();">메뉴삭제</button>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                            
                        <div class="pageWrap">
                            <a href = "#">◀ 이전</a> 
                            <a href = "#">1</a>  
                            <a href = "#">다음 ▶</a>
                        </div>
                            
                        <div class="writeBtnWrap">
                            <input type="button" value="목록" class="btn listBtn"/>
                            <input type="button" value="글쓰기" class="btn writeBtn" onclick="location.href='./ceoPost.html'"/>
                        </div>

                    </div>
                </div>
            </section>
        </main>

        <!-- footer -->
        <footer id="footer">
            <div class="inner">
                <p>made by team.qwerty</p>
            </div>
        </footer>

    </div>

    <!-- script part -->
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script>
        // 테이블 행을 동적으로 생성하는 함수
        function generateTableRows(dataArray) {
            const tableBody = document.querySelector("#menuTable tbody");
            tableBody.innerHTML = ""; // 기존의 행들을 삭제합니다.

            for (let i = 0; i < dataArray.length; i++) {
                const item = dataArray[i];

                const row = document.createElement("tr");

                const storeIdCell = document.createElement("td");
                storeIdCell.textContent = item.storeId;
                row.appendChild(storeIdCell);

                const menuNameCell = document.createElement("td");
                menuNameCell.textContent = item.menuName;
                row.appendChild(menuNameCell);

                const menuImageCell = document.createElement("td");
                menuImageCell.textContent = item.menuImage;
                row.appendChild(menuImageCell);

                const priceCell = document.createElement("td");
                priceCell.textContent = item.price;
                row.appendChild(priceCell);

                const menuChangeCell = document.createElement("td");
                const changeBtn = document.createElement("button");
                changeBtn.textContent = "메뉴수정";
                changeBtn.onclick = () => menuChange(item.menuId); // 수정 함수에 메뉴 아이디를 넘깁니다.
                menuChangeCell.appendChild(changeBtn);
                row.appendChild(menuChangeCell);

                const menuDeleteCell = document.createElement("td");
                const deleteBtn = document.createElement("button");
                deleteBtn.textContent = "메뉴삭제";
                deleteBtn.onclick = () => menuDelete(item.menuId); // 삭제 함수에 메뉴 아이디를 넘깁니다.
                menuDeleteCell.appendChild(deleteBtn);
                row.appendChild(menuDeleteCell);

                tableBody.appendChild(row);
            }
        }

        // table db 데이터 값 출력
        const data = {
            email: $('#email'),
            password: $('#password'),
            confirm: $('#passwordConfirm'),
            storeName: $('#storeName'),
            storeImage: $('#storeImage'),
        }

        axios.get('http://localhost:3000/api/ceo/getMenuAll', data)
            .then(response => {
                console.log(response);

                const dataArray = response.data.data;
                generateTableRows(dataArray); // 테이블 행 생성 함수를 호출하여 데이터로 테이블을 업데이트합니다.

            })
            .catch(function (error) {
                console.log(error);
            })

        // 메뉴 수정
        function menuChange(menuId) {
            const data = {
                menuName: $('#menuName').val(),
                menuImage: $('#menuImage').val(),
                price: $('#price').val(),
            }
            console.log(data)
            axios.post(`http://localhost:3000/api/ceo/updateMenu/${menuId}`, data)
                .then(request => {
                    alert('음식수정완료!');
                })
                .catch(function (error) {
                    console.log(error);
                })
        }

        // 메뉴 삭제
        function menuDelete(menuId) {
            // 삭제를 처리하는 로직을 추가하세요.
        }

        // logout
        function logout() {
            try {
                axios.post('http://localhost:3000/api/ceo/logout')
                    .then(response => {
                        alert('사장님!!!!! 살펴가십쇼!!');
                    })
            } catch (error) {
                console.log(error);
            }
        }
    </script>

    
</body>
</html>